<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß† ÁãóÁãóÊô∫ÂäõÊ∏¨È©ó</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #b8d4b8 0%, #a8c9a8 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .language-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            background: white;
            padding: 10px 15px;
            border-radius: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border: 2px solid #ff8c42;
            z-index: 1000;
        }

        .lang-btn {
            background: transparent;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 14px;
            color: #666;
            border-radius: 10px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .lang-btn:hover {
            background: #fff8f2;
            color: #ff8c42;
        }

        .lang-btn.active {
            background: #ff8c42;
            color: white;
            font-weight: 600;
        }

        .container {
            background: white;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            max-width: 700px;
            width: 100%;
            padding: 40px;
            animation: fadeIn 0.5s ease-in;
            border: 4px solid #ff8c42;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .logo {
            text-align: center;
            margin-bottom: 20px;
        }

        .logo-icon {
            width: 120px;
            height: 120px;
            margin: 0 auto;
        }

        h1 {
            color: #2c3e2c;
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #5a6b5a;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .input-group {
            margin-bottom: 30px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            color: #2c3e2c;
            font-weight: 600;
        }

        input[type="text"] {
            width: 100%;
            padding: 15px;
            border: 3px solid #ff8c42;
            border-radius: 15px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #ff6b1a;
            box-shadow: 0 0 0 3px rgba(255, 140, 66, 0.2);
        }

        input[type="file"] {
            display: none;
        }

        .photo-upload {
            text-align: center;
            margin-bottom: 20px;
        }

        .photo-preview {
            width: 200px;
            height: 200px;
            margin: 15px auto;
            border-radius: 50%;
            overflow: hidden;
            border: 4px solid #ff8c42;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 14px;
        }

        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            background: #ff8c42;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 15px;
            font-size: 18px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            font-weight: 600;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 140, 66, 0.3);
            background: #ff7a2e;
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .progress-bar {
            height: 10px;
            background: #e8f0e8;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            border: 2px solid #ff8c42;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff8c42 0%, #ffa560 100%);
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            color: #5a6b5a;
            margin-bottom: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .category-badge {
            display: inline-block;
            background: #fff3e6;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            margin-bottom: 20px;
            color: #ff8c42;
            font-weight: 600;
            border: 2px solid #ff8c42;
        }

        .question {
            font-size: 1.2em;
            color: #2c3e2c;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }

        .option-btn {
            background: white;
            border: 3px solid #e8f0e8;
            padding: 20px;
            border-radius: 15px;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            color: #2c3e2c;
        }

        .option-btn:hover {
            border-color: #ff8c42;
            background: #fff8f2;
        }

        .option-btn.selected {
            border-color: #ff8c42;
            background: #fff3e6;
            font-weight: 600;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn-secondary {
            background: white;
            color: #ff8c42;
            border: 3px solid #ff8c42;
        }

        .btn-secondary:hover {
            background: #fff8f2;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 140, 66, 0.3);
        }

        .result-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .result-dog-photo {
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
            border-radius: 50%;
            overflow: hidden;
            border: 4px solid #ff8c42;
        }

        .result-dog-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .result-title-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .result-icon {
            font-size: 60px;
        }

        .result-title {
            font-size: 2em;
            color: #ff8c42;
            font-weight: bold;
        }

        .result-score {
            text-align: center;
            font-size: 1.5em;
            color: #2c3e2c;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .result-message {
            text-align: center;
            font-size: 1.1em;
            color: #2c3e2c;
            margin-bottom: 20px;
            padding: 0 20px;
            line-height: 1.6;
        }

        .result-description {
            background: #f8fdf8;
            padding: 20px;
            border-radius: 15px;
            color: #2c3e2c;
            line-height: 1.8;
            border: 3px solid #b8d4b8;
            margin-bottom: 20px;
        }

        .disclaimer {
            text-align: center;
            font-size: 0.9em;
            color: #999;
            margin-bottom: 20px;
            font-style: italic;
        }

        .share-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        #certificateCanvas {
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 25px;
            }

            h1 {
                font-size: 2em;
            }

            .subtitle {
                font-size: 1em;
            }

            .logo-icon {
                width: 100px;
                height: 100px;
            }

            .photo-buttons {
                flex-direction: column;
            }

            .language-switcher {
                top: 10px;
                right: 10px;
                padding: 8px 12px;
            }

            .lang-btn {
                font-size: 12px;
                padding: 4px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="language-switcher">
        <button class="lang-btn active" onclick="switchLanguage('zh')">‰∏≠Êñá</button>
        <button class="lang-btn" onclick="switchLanguage('en')">English</button>
        <button class="lang-btn" onclick="switchLanguage('nl')">Nederlands</button>
    </div>

    <div class="container">
       <div id="welcome" class="screen active">
            <div class="logo">
                <img src="logo.png" class="logo-icon">
            </div>
            <h1 id="title">ÁãóÁãóÊô∫ÂäõÊ∏¨È©ó</h1>
            <p class="subtitle" id="subtitle">12 ÈÅìÈ°åÁõÆÔºåÊè≠Èñã‰Ω†ÂÆ∂ÊØõÂ≠©ÁöÑÂ§©ÊâçÊåáÊï∏ÔºÅ</p>
            
            <div class="input-group">
                <label for="dogName" id="nameLabel">Ë´ãËº∏ÂÖ•‰Ω†ÂÆ∂ÁãóÁãóÁöÑÂêçÂ≠óÔºö</label>
                <input type="text" id="dogName" placeholder="‰æãÂ¶ÇÔºöChewy„ÄÅÂàù‰∏Ä" required>
            </div>
            
            <button class="btn" onclick="startTest()" id="startBtn">ÈñãÂßãÊ∏¨È©ó üêæ</button>
        </div>

        <div id="quiz" class="screen">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p class="progress-text" id="progressText">Á¨¨ 1 È°åÔºåÂÖ± 12 È°å</p>
            
            <span class="category-badge" id="categoryBadge"></span>
            
            <div class="question" id="questionText"></div>
            
            <div class="options" id="optionsContainer"></div>
            
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="previousQuestion()" id="prevBtn" style="display:none;">‰∏ä‰∏ÄÈ°å</button>
                <button class="btn" onclick="nextQuestion()" id="nextBtn" disabled>‰∏ã‰∏ÄÈ°å</button>
            </div>
        </div>

        <div id="photo" class="screen">
            <h1 style="text-align: center; color: #2c3e2c; margin-bottom: 10px;" id="photoTitle">üì∏ ‰∏äÂÇ≥ÁãóÁãóÁÖßÁâá</h1>
            <p class="subtitle" id="photoSubtitle">ËÆìË≠âÊõ∏Êõ¥ÊúâÁ¥ÄÂøµÂÉπÂÄºÔºÅ</p>
            
            <div class="photo-upload">
                <div class="photo-preview" id="photoPreviewStep">üì∑</div>
                <input type="file" id="dogPhotoCamera" accept="image/*" capture="environment" onchange="previewPhoto('camera')">
                <input type="file" id="dogPhotoGallery" accept="image/*" onchange="previewPhoto('gallery')">
                
                <div class="photo-buttons">
                    <button class="btn" onclick="document.getElementById('dogPhotoCamera').click()" id="takePhotoBtn">üì∑ ÊãçÁÖß</button>
                    <button class="btn btn-secondary" onclick="document.getElementById('dogPhotoGallery').click()" id="choosePhotoBtn">üñºÔ∏è ÂæûÁõ∏Á∞øÈÅ∏Êìá</button>
                </div>
            </div>
            
            <button class="btn" onclick="showResult()" style="margin-top: 20px;" id="viewResultBtn">Êü•ÁúãÁµêÊûú ‚ú®</button>
            <button class="btn btn-secondary" onclick="skipPhoto()" style="margin-top: 10px;" id="skipBtn">Ë∑≥ÈÅé</button>
        </div>

        <div id="result" class="screen">
            <div class="result-header">
                <div class="result-dog-photo" id="resultDogPhoto" style="display:none;">
                    <img id="resultDogPhotoImg" src="" alt="ÁãóÁãóÁÖßÁâá">
                </div>
                
                <div class="result-title-row">
                    <span class="result-icon" id="resultIcon"></span>
                    <h2 class="result-title" id="resultTitle"></h2>
                </div>
                
                <p class="result-score" id="resultScore"></p>
                <p class="result-message" id="resultMessage"></p>
            </div>

            <div class="result-description" id="resultDescription"></div>
            
            <p class="disclaimer" id="disclaimer">* Êú¨Ê∏¨È©óÂÉÖ‰æõÂ®õÊ®ÇÂèÉËÄÉÔºå‰∏ç‰ª£Ë°®ÁúüÂØ¶ÁöÑÁãóÁãóÊô∫ÂïÜË©ï‰º∞</p>
            
            <div class="share-buttons">
                <button class="btn" onclick="downloadCertificate()" id="downloadBtn">‰∏ãËºâÊô∫ÂäõË≠âÊòé üìú</button>
                <button class="btn btn-secondary" onclick="restartTest()" id="restartBtn">ÈáçÊñ∞Ê∏¨È©ó üîÑ</button>
            </div>
        </div>
    </div>

    <canvas id="certificateCanvas" width="1200" height="900"></canvas>

    <script>
        var currentLang = 'zh';
        
        var translations = {
            zh: {
                title: 'ÁãóÁãóÊô∫ÂäõÊ∏¨È©ó',
                subtitle: '12 ÈÅìÈ°åÁõÆÔºåÊè≠Èñã‰Ω†ÂÆ∂ÊØõÂ≠©ÁöÑÂ§©ÊâçÊåáÊï∏ÔºÅ',
                nameLabel: 'Ë´ãËº∏ÂÖ•‰Ω†ÂÆ∂ÁãóÁãóÁöÑÂêçÂ≠óÔºö',
                namePlaceholder: '‰æãÂ¶ÇÔºöChewy„ÄÅÂàù‰∏Ä',
                startBtn: 'ÈñãÂßãÊ∏¨È©ó üêæ',
                prevBtn: '‰∏ä‰∏ÄÈ°å',
                nextBtn: '‰∏ã‰∏ÄÈ°å',
                photoTitle: 'üì∏ ‰∏äÂÇ≥ÁãóÁãóÁÖßÁâá',
                photoSubtitle: 'ËÆìË≠âÊõ∏Êõ¥ÊúâÁ¥ÄÂøµÂÉπÂÄºÔºÅ',
                takePhotoBtn: 'üì∑ ÊãçÁÖß',
                choosePhotoBtn: 'üñºÔ∏è ÂæûÁõ∏Á∞øÈÅ∏Êìá',
                viewResultBtn: 'Êü•ÁúãÁµêÊûú ‚ú®',
                skipBtn: 'Ë∑≥ÈÅé',
                downloadBtn: '‰∏ãËºâÊô∫ÂäõË≠âÊòé üìú',
                restartBtn: 'ÈáçÊñ∞Ê∏¨È©ó üîÑ',
                disclaimer: '* Êú¨Ê∏¨È©óÂÉÖ‰æõÂ®õÊ®ÇÂèÉËÄÉÔºå‰∏ç‰ª£Ë°®ÁúüÂØ¶ÁöÑÁãóÁãóÊô∫ÂïÜË©ï‰º∞',
                scoreText: ' ÁöÑÊô∫ÂïÜÂæóÂàÜÔºö',
                pointsText: ' ÂàÜ',
                certTitle: 'ÁãóÁãóÊô∫ÂäõÊ∏¨È©óË≠âÊòéÊõ∏',
                certExcellence: 'Âú®ÁãóÁãóÊô∫ÂäõÊ∏¨È©ó‰∏≠Ë°®ÁèæÂÑ™Áï∞',
                certScore: 'Êô∫ÂïÜÂæóÂàÜÔºö',
                certOrg: 'Ë®≠Ë®àËàáË£Ω‰ΩúÔºö@3xs_travel_chewy',
                certDate: 'È†íÁôºÊó•ÊúüÔºö',
                progressText: 'Á¨¨ {current} È°åÔºåÂÖ± 12 È°å'
            },
            en: {
                title: 'Dog IQ Test',
                subtitle: '12 questions to reveal your dog\'s genius level!',
                nameLabel: 'Enter your dog\'s name:',
                namePlaceholder: 'e.g., Chewy, Max',
                startBtn: 'Start Test üêæ',
                prevBtn: 'Previous',
                nextBtn: 'Next',
                photoTitle: 'üì∏ Upload Dog Photo',
                photoSubtitle: 'Make your certificate more memorable!',
                takePhotoBtn: 'üì∑ Take Photo',
                choosePhotoBtn: 'üñºÔ∏è Choose from Gallery',
                viewResultBtn: 'View Results ‚ú®',
                skipBtn: 'Skip',
                downloadBtn: 'Download Certificate üìú',
                restartBtn: 'Restart Test üîÑ',
                disclaimer: '* This test is for entertainment purposes only and does not represent actual dog intelligence assessment',
                scoreText: '\'s IQ Score: ',
                pointsText: ' points',
                certTitle: 'Dog Intelligence Test Certificate',
                certExcellence: 'Demonstrated Excellence in Dog Intelligence Testing',
                certScore: 'IQ Score: ',
                certOrg: 'Designed & Created by: @3xs_travel_chewy',
                certDate: 'Date Issued: ',
                progressText: 'Question {current} of 12'
            },
            nl: {
                title: 'Honden IQ Test',
                subtitle: '12 vragen om het genieniveau van je hond te onthullen!',
                nameLabel: 'Voer de naam van je hond in:',
                namePlaceholder: 'bijv., Chewy, Max',
                startBtn: 'Start Test üêæ',
                prevBtn: 'Vorige',
                nextBtn: 'Volgende',
                photoTitle: 'üì∏ Upload Hondenfoto',
                photoSubtitle: 'Maak je certificaat gedenkwaardiger!',
                takePhotoBtn: 'üì∑ Foto Maken',
                choosePhotoBtn: 'üñºÔ∏è Kies uit Galerij',
                viewResultBtn: 'Bekijk Resultaten ‚ú®',
                skipBtn: 'Overslaan',
                downloadBtn: 'Download Certificaat üìú',
                restartBtn: 'Test Opnieuw üîÑ',
                disclaimer: '* Deze test is alleen voor entertainment en vertegenwoordigt geen daadwerkelijke intelligentiebeoordeling van honden',
                scoreText: '\'s IQ-score: ',
                pointsText: ' punten',
                certTitle: 'Honden Intelligentie Test Certificaat',
                certExcellence: 'Toonde uitstekende prestaties in honden intelligentie testen',
                certScore: 'IQ-score: ',
                certOrg: 'Ontworpen & Gemaakt door: @3xs_travel_chewy',
                certDate: 'Uitgiftedatum: ',
                progressText: 'Vraag {current} van 12'
            }
        };

        var questions = {
            zh: [
                { category: 'üêæ ÁîüÊ¥ªÊáâÂ∞ç', q: 'Áï∂‰Ω†Ê≠£Âú®Âπ´‰Ω†ÁöÑÂ∞èÁãóÊ∫ñÂÇôÊ≠£È§êÊôÇÔºåÂ∞èÁãóÊúâÊ≤íÊúâÁêÜËß£‰∏¶‰∏îÂÅöÂá∫ÂèçÊáâÂë¢Ôºü', options: [
                    { text: 'Áõ¥Êé•Ë°ùÂà∞ÂªöÊàøÁ≠âÂæÖ', score: 10 },
                    { text: 'ÊúâÊÑüÊáâÂà∞Êúâ‰∫ãÊÉÖË¶ÅÁôºÁîü‰∫Ü', score: 6 },
                    { text: 'Ê≤íÊúâÂèçÊáâ', score: 3 }
                ]},
                { category: 'üêæ ÁîüÊ¥ªÊáâÂ∞ç', q: 'Áï∂‰Ω†Êî∂ÊãæËÉåÂåÖÊ∫ñÂÇôÂá∫ÈñÄÊóÖË°åÔºåÁâ†ÊúÉÔºü', options: [
                    { text: 'Êó©Êó©ÂØüË¶∫ÔºåÈñãÂßãË∑üËëó‰Ω†', score: 10 },
                    { text: 'Âà∞ÊúÄÂæåÊâçÁôºÁèæ', score: 6 },
                    { text: 'ÂÆåÂÖ®‰∏çÁü•ÈÅì', score: 3 }
                ]},
                { category: 'üêæ ÁîüÊ¥ªÊáâÂ∞ç', q: 'Áï∂Áâ†ËÅΩÂà∞‰Ω†Ë™™„ÄåË¶ÅÂéªÊï£Ê≠•ÂóéÔºü„ÄçÊôÇÔºü', options: [
                    { text: 'ÁßíË°ùÂà∞ÈñÄÈÇä', score: 10 },
                    { text: 'ÂÖàËßÄÂØü‰Ω†ÊòØ‰∏çÊòØË™çÁúüÁöÑ', score: 6 },
                    { text: 'Ê≤íÁâπÂà•ÂèçÊáâ', score: 3 }
                ]},
                { category: 'ü¶¥ ÂïèÈ°åËß£Ê±∫', q: 'Áï∂Áâ†ÁöÑÁé©ÂÖ∑Âç°Âú®Ê≤ôÁôº‰∏ãÊôÇÔºü', options: [
                    { text: 'Áî®Áà™Â≠êÊàñÈºªÂ≠êÊí•Âá∫‰æÜ', score: 10 },
                    { text: 'Â∞çËëóÊ≤ôÁôºÂè´', score: 6 },
                    { text: 'ËΩâÈ†≠ÂéªÁé©Âà•ÁöÑ', score: 3 }
                ]},
                { category: 'ü¶¥ ÂïèÈ°åËß£Ê±∫', q: 'Â∞èÁãóÊúÉ‰∏çÊúÉÂú®Â§èÂ§©ÈÅãÂãïÂæåÂè£Ê∏¥ÊôÇËá™ÂãïÂéªÂñùÊ∞¥Ôºü', options: [
                    { text: 'ÊúÉËá™Â∑±Ê∏¥‰∫ÜÂ∞±ÂéªÂñù', score: 10 },
                    { text: 'ÂÅ∂ÁàæÊúÉËá™Â∑±‰æÜË∑üÊàëË¶ÅÊ∞¥', score: 6 },
                    { text: 'ÈÉΩË¶ÅÊàëÊãøÊ∞¥Áµ¶‰ªñÂñù', score: 3 }
                ]},
                { category: 'üê∂ Á§æ‰∫§ÁêÜËß£', q: 'Áï∂‰Ω†ÊåáËëóÊüêÂÄãÊù±Ë•øË™™„ÄåÁúãÈÇ£ÈÇäÔºÅ„ÄçÔºåÁâ†ÊúÉÔºü', options: [
                    { text: 'Ë∑üËëó‰Ω†ÊåáÁöÑÊñπÂêëÁúã', score: 10 },
                    { text: 'Áúã‰Ω†ÁöÑÊâãÊåá', score: 6 },
                    { text: 'ÂÆåÂÖ®‰∏çÊáÇ', score: 3 }
                ]},
                { category: 'üß© Â≠∏ÁøíÂäõ', q: 'Â≠∏Êñ∞Êåá‰ª§ÊôÇÔºàÂ¶Ç„ÄåÂùê‰∏ã„ÄçÔºâÔºåÁâ†Âπ≥ÂùáÂπæÊ¨°ËÉΩÂ≠∏ÊúÉÔºü', options: [
                    { text: '1-3 Ê¨°', score: 10 },
                    { text: '4-7 Ê¨°', score: 6 },
                    { text: '8 Ê¨°‰ª•‰∏ä', score: 3 }
                ]},
                { category: 'üß© Â≠∏ÁøíÂäõ', q: 'Áï∂‰Ω†Êèõ‰∫ÜÊñ∞ÁöÑÁé©ÂÖ∑ÂêçÁ®±ÔºàÂ¶Ç„ÄåÁêÉÁêÉ„Äç‚Üí„ÄåÂí¨Âí¨„ÄçÔºâÔºåÁâ†ËÉΩË®òÂæóÂóéÔºü', options: [
                    { text: 'ÂæàÂø´Â∞±Ë®òËµ∑Êñ∞ÂêçÂ≠ó', score: 10 },
                    { text: 'Ë¶ÅÁ∑¥ÂπæÊ¨°', score: 6 },
                    { text: 'ÂÆåÂÖ®Ê∑∑‰∫Ç', score: 3 }
                ]},
                { category: 'üêæ ËßÄÂØüË®òÊÜ∂', q: 'Áï∂‰Ω†ÂÅáË£ù‰∏üÁêÉ‰ΩÜÂÖ∂ÂØ¶Ê≤í‰∏üÊôÇÔºåÁãóÁãóÁöÑÂèçÊáâÊòØÔºü', options: [
                    { text: 'È¶¨‰∏äÁúãÂá∫‰Ω†Âú®È®ôÁâ†', score: 10 },
                    { text: 'Áúã‰∫Ü‰∏Ä‰∏ãÂú∞ÊùøÂæåÊâçÁôºÁèæ', score: 6 },
                    { text: '‰∏ÄÁõ¥ÊâæÁêÉÂà∞ËôïË∑ë', score: 3 }
                ]},
                { category: 'üêæ ËßÄÂØüË®òÊÜ∂', q: 'Áï∂‰Ω†ÁßªÂãïÁâ†Â∏∏Áù°ÁöÑÊØØÂ≠êÂà∞Âà•ÁöÑÂú∞ÊñπÔºåÁâ†ÊúÉÔºü', options: [
                    { text: 'Á´ãÂàªÊâæÂà∞‰∏¶Ë∫∫‰∏äÂéª', score: 10 },
                    { text: 'Á®çÂæÆËÅû‰∏ÄËÅûÊâçË∫∫‰∏ã', score: 6 },
                    { text: 'ÂÆåÂÖ®Ê≤íÊ≥®ÊÑè', score: 3 }
                ]},
                { category: 'üêæ ËßÄÂØüË®òÊÜ∂', q: 'Áï∂‰Ω†ÊïÖÊÑèËµ∞ÂéªÈñÄÂè£ÊãøÁâΩÁπ©ÔºåÁãóÁãóÂèçÊáâÊòØÔºü', options: [
                    { text: 'Á´ãÂàªËààÂ•ÆË∑≥Ëµ∑‰æÜ', score: 10 },
                    { text: 'Áúã‰Ω†ÂπæÁßíÊâçËµ∑‰æÜ', score: 6 },
                    { text: 'ÂÆåÂÖ®Ê≤íÂèçÊáâ', score: 3 }
                ]},
                { category: 'üêï Á©∫ÈñìÊÑüÁü•', q: 'Áï∂Áâ†ÁúãÂà∞Èè°Â≠êË£°ÁöÑËá™Â∑±ÔºåÁâ†ÊúÉÔºü', options: [
                    { text: 'ËßÄÂØü‰∏Ä‰∏ãÂæå‰∏çÂú®ÊÑè', score: 10 },
                    { text: 'Âê†Âè´Âπæ‰∏ã', score: 6 },
                    { text: 'Â∞çÈè°Â≠êÁîüÊ∞£', score: 3 }
                ]}
            ],
            en: [
                { category: 'üêæ Daily Adaptation', q: 'When you prepare your dog\'s meal, does your dog understand and respond?', options: [
                    { text: 'Rushes to the kitchen and waits', score: 10 },
                    { text: 'Senses something is happening', score: 6 },
                    { text: 'No reaction', score: 3 }
                ]},
                { category: 'üêæ Daily Adaptation', q: 'When you pack your bags for a trip, does your dog:', options: [
                    { text: 'Notice early and follow you', score: 10 },
                    { text: 'Only realize at the last moment', score: 6 },
                    { text: 'Completely unaware', score: 3 }
                ]},
                { category: 'üêæ Daily Adaptation', q: 'When you say "Want to go for a walk?", your dog:', options: [
                    { text: 'Rushes to the door immediately', score: 10 },
                    { text: 'Observes if you\'re serious first', score: 6 },
                    { text: 'No particular reaction', score: 3 }
                ]},
                { category: 'ü¶¥ Problem Solving', q: 'When your dog\'s toy gets stuck under the sofa:', options: [
                    { text: 'Uses paws or nose to get it out', score: 10 },
                    { text: 'Barks at the sofa', score: 6 },
                    { text: 'Turns to play with something else', score: 3 }
                ]},
                { category: 'ü¶¥ Problem Solving', q: 'Does your dog automatically drink water when thirsty after exercise in summer?', options: [
                    { text: 'Goes to drink on their own', score: 10 },
                    { text: 'Sometimes asks me for water', score: 6 },
                    { text: 'Always needs me to bring water', score: 3 }
                ]},
                { category: 'üê∂ Social Understanding', q: 'When you point at something and say "Look over there!", your dog:', options: [
                    { text: 'Looks in the direction you point', score: 10 },
                    { text: 'Looks at your finger', score: 6 },
                    { text: 'Doesn\'t understand at all', score: 3 }
                ]},
                { category: 'üß© Learning Ability', q: 'When learning a new command (like "sit"), how many times on average before learning?', options: [
                    { text: '1-3 times', score: 10 },
                    { text: '4-7 times', score: 6 },
                    { text: '8+ times', score: 3 }
                ]},
                { category: 'üß© Learning Ability', q: 'When you change a toy\'s name (like "ball" ‚Üí "chew"), can your dog remember?', options: [
                    { text: 'Quickly remembers the new name', score: 10 },
                    { text: 'Needs several practices', score: 6 },
                    { text: 'Completely confused', score: 3 }
                ]},
                { category: 'üêæ Observation & Memory', q: 'When you pretend to throw a ball but don\'t actually throw it:', options: [
                    { text: 'Immediately realizes you\'re tricking them', score: 10 },
                    { text: 'Looks at the ground before realizing', score: 6 },
                    { text: 'Keeps running around looking for the ball', score: 3 }
                ]},
                { category: 'üêæ Observation & Memory', q: 'When you move their usual sleeping blanket to another place:', options: [
                    { text: 'Immediately finds and lies on it', score: 10 },
                    { text: 'Sniffs a bit before lying down', score: 6 },
                    { text: 'Doesn\'t notice at all', score: 3 }
                ]},
                { category: 'üêæ Observation & Memory', q: 'When you deliberately go to the door to get the leash:', options: [
                    { text: 'Immediately gets excited and jumps up', score: 10 },
                    { text: 'Watches you for a few seconds before getting up', score: 6 },
                    { text: 'No reaction', score: 3 }
                ]},
                { category: 'üêï Spatial Awareness', q: 'When your dog sees themselves in the mirror:', options: [
                    { text: 'Observes briefly then ignores it', score: 10 },
                    { text: 'Barks a few times', score: 6 },
                    { text: 'Gets angry at the mirror', score: 3 }
                ]}
            ],
            nl: [
                { category: 'üêæ Dagelijkse Aanpassing', q: 'Als je de maaltijd van je hond voorbereidt, begrijpt en reageert je hond?', options: [
                    { text: 'Rent naar de keuken en wacht', score: 10 },
                    { text: 'Voelt dat er iets gebeurt', score: 6 },
                    { text: 'Geen reactie', score: 3 }
                ]},
                { category: 'üêæ Dagelijkse Aanpassing', q: 'Als je je tassen pakt voor een reis, doet je hond:', options: [
                    { text: 'Merkt het vroeg op en volgt je', score: 10 },
                    { text: 'Realiseert het pas op het laatste moment', score: 6 },
                    { text: 'Volledig onbewust', score: 3 }
                ]},
                { category: 'üêæ Dagelijkse Aanpassing', q: 'Als je zegt "Wil je gaan wandelen?", doet je hond:', options: [
                    { text: 'Rent meteen naar de deur', score: 10 },
                    { text: 'Observeert eerst of je het meent', score: 6 },
                    { text: 'Geen bijzondere reactie', score: 3 }
                ]},
                { category: 'ü¶¥ Probleemoplossing', q: 'Als het speelgoed van je hond onder de bank zit:', options: [
                    { text: 'Gebruikt poten of neus om het eruit te halen', score: 10 },
                    { text: 'Blaft naar de bank', score: 6 },
                    { text: 'Gaat met iets anders spelen', score: 3 }
                ]},
                { category: 'ü¶¥ Probleemoplossing', q: 'Drinkt je hond automatisch water als hij dorst heeft na inspanning in de zomer?', options: [
                    { text: 'Gaat zelf drinken', score: 10 },
                    { text: 'Vraagt me soms om water', score: 6 },
                    { text: 'Moet altijd water krijgen', score: 3 }
                ]},
                { category: 'üê∂ Sociaal Begrip', q: 'Als je naar iets wijst en zegt "Kijk daar!", doet je hond:', options: [
                    { text: 'Kijkt in de richting die je aanwijst', score: 10 },
                    { text: 'Kijkt naar je vinger', score: 6 },
                    { text: 'Begrijpt het helemaal niet', score: 3 }
                ]},
                { category: 'üß© Leervermogen', q: 'Bij het leren van een nieuw commando (zoals "zit"), hoeveel keer gemiddeld voordat het geleerd is?', options: [
                    { text: '1-3 keer', score: 10 },
                    { text: '4-7 keer', score: 6 },
                    { text: '8+ keer', score: 3 }
                ]},
                { category: 'üß© Leervermogen', q: 'Als je de naam van een speeltje verandert (zoals "bal" ‚Üí "knabbel"), kan je hond het onthouden?', options: [
                    { text: 'Onthoudt snel de nieuwe naam', score: 10 },
                    { text: 'Heeft enkele oefeningen nodig', score: 6 },
                    { text: 'Volledig in de war', score: 3 }
                ]},
                { category: 'üêæ Observatie & Geheugen', q: 'Als je doet alsof je een bal gooit maar eigenlijk niet gooit:', options: [
                    { text: 'Realiseert meteen dat je ze voor de gek houdt', score: 10 },
                    { text: 'Kijkt naar de grond voordat ze het doorhebben', score: 6 },
                    { text: 'Blijft rondrennen op zoek naar de bal', score: 3 }
                ]},
                { category: 'üêæ Observatie & Geheugen', q: 'Als je hun gebruikelijke slaapkleed naar een andere plek verplaatst:', options: [
                    { text: 'Vindt het meteen en gaat erop liggen', score: 10 },
                    { text: 'Snuffelt wat voordat ze gaan liggen', score: 6 },
                    { text: 'Merkt het helemaal niet op', score: 3 }
                ]},
                { category: 'üêæ Observatie & Geheugen', q: 'Als je opzettelijk naar de deur gaat om de riem te pakken:', options: [
                    { text: 'Wordt meteen enthousiast en springt op', score: 10 },
                    { text: 'Kijkt je een paar seconden aan voordat ze opstaan', score: 6 },
                    { text: 'Geen reactie', score: 3 }
                ]},
                { category: 'üêï Ruimtelijk Bewustzijn', q: 'Als je hond zichzelf in de spiegel ziet:', options: [
                    { text: 'Observeert kort en negeert het dan', score: 10 },
                    { text: 'Blaft een paar keer', score: 6 },
                    { text: 'Wordt boos op de spiegel', score: 3 }
                ]}
            ]
        };

        var levels = {
            zh: [
                { min: 36, icon: 'üåº', title: 'Â∞èÂèØÊÑõÊé¢Á¥¢ÂÆ∂', desc: 'Â∞ç‰∏ñÁïåÂÖÖÊªøÂ•ΩÂ•á‰ΩÜË°åÂãïÊ¥æ‰∏çÂº∑ÔºåÂ∏∏Áî®„ÄåËêåÊ®£„ÄçËß£Ê±∫ÂïèÈ°å„ÄÇÂèØËÉΩÈÇÑÈúÄË¶Å‰∏ÄÈªûÊôÇÈñìÁêÜËß£Êåá‰ª§Ôºå‰ΩÜÁâ†ÁöÑËÄêÂøÉËàáË¶™ÂíåÂäõÁµïÂ∞çÊªøÂàÜ„ÄÇ', msgs: ['Áî®ÁÑ°ËæúÂ§ßÁúºË≠âÊòéÔºöÂèØÊÑõÂ∞±ÊòØÊúÄÂº∑Ê≠¶Âô®ÔºÅüíï', 'ÁöÑ‰∫∫ÁîüÂì≤Â≠∏ÔºöÁÇ∫‰ªÄÈ∫ºË¶ÅÂä™ÂäõÔºüË∫∫ËëóÁ≠âÊë∏Êë∏‰∏çÂ•ΩÂóéÔºüüòå'] },
                { min: 72, icon: 'üêï', title: 'ÈñãÊúóÂ≠∏ÁøíÁîü', desc: 'ËßÄÂØüÂäõËàáÂèçÊáâÂäõ‰∏çÈåØÔºåÂÅ∂ÁàæÊúÉÂàÜÂøÉÔºå‰ΩÜÂè™Ë¶ÅÈ°òÊÑèÂ≠∏Â∞±ÈÄ≤Ê≠•ÂæàÂø´„ÄÇÊáÇÂæóÁî®ÁúºÁ•ûËÆÄÁ©∫Ê∞£ÔºåÊòØ‰∫∫È°ûÊÉÖÁ∑íÁöÑÂ•ΩÊÑüÊáâÂô®„ÄÇ', msgs: ['Ê≠£Âú®Áî®ÂøÉÊÑüÂèó‰Ω†ÁöÑÊØèÂÄãÊÉÖÁ∑íËÆäÂåñ üíô', 'Â≠∏ÁøíÈÄüÂ∫¶Âø´ÔºåÂ∞±ÊòØÂÅ∂ÁàæÊúÉË¢´Èõ∂È£üÂàÜÂøÉËÄåÂ∑≤ üòã'] },
                { min: 96, icon: 'üß†', title: 'Ê©üÈùàÂ§•‰º¥Âûã', desc: 'ÊÄùËÄÉÈùàÊ¥ª„ÄÅËÉΩËàâ‰∏ÄÂèç‰∏âÔºåÊáÇÂæóËßÄÂØüÊÉÖÂ¢É‰∏¶ÂÅöÂá∫Â∞çÊáâË°åÂãï„ÄÇÂ≠∏Êñ∞Êåá‰ª§ÈÄüÂ∫¶Âø´Ôºå‰πüÁü•ÈÅì‰ªÄÈ∫ºÊôÇÂÄôË©≤„ÄåË£ùÂÇª„ÄçË®éÊë∏Êë∏„ÄÇ', msgs: ['ÁöÑÊ∏¨È©óÁµêÊûúÊòØ üí° Ê©üÈùàÂ§•‰º¥ÂûãÔºÅÂ∑≤Á∂ìÂ≠∏ÊúÉ‰ªÄÈ∫ºÊôÇÂÄôË©≤Ë£ùÂÇª‰∫Ü üòè', 'Âú®ÊÄùËÄÉÊÄéÈ∫ºÁî®ÊúÄÂ∞ëÂäõÊ∞£Áç≤ÂæóÊúÄÂ§öÈõ∂È£ü üß†‚ú®'] },
                { min: 108, icon: 'üöÄ', title: 'ËÅ∞ÊòéÈ´òÊùêÁîü', desc: '‰∏çÂè™ÊúÉÂ≠∏ÔºåÈÇÑÊúÉËßÄÂØü‰Ω†„ÄÅÊ∏¨Ë©¶‰Ω†„ÄÇËÉΩËá™Â∑±ÊâæËß£Ê≥ï„ÄÅÁêÜËß£Âõ†ÊûúÔºåÊòØÂ∞èÂ∞èÂïèÈ°åËß£Ê±∫È´òÊâã„ÄÇÂèØËÉΩÊúÉ„ÄåÂ§™ËÅ∞Êòé„ÄçÂà∞ËÆìÈ£º‰∏ªÂïûÂè£ÁÑ°Ë®Ä„ÄÇ', msgs: ['Â∑≤Á∂ìÈñãÂßãËßÄÂØü‰Ω†ÁöÑË°åÁÇ∫Ê®°Âºè‰∫Ü üîç', 'ÂèØËÉΩÊ≠£Âú®Ê∏¨Ë©¶‰Ω†ÁöÑÂ∫ïÁ∑öÂú®Âì™Ë£° ü§ì'] },
                { min: 120, icon: 'üåü', title: 'ÁãóÁïåÂ§©ÊâçÁéã', desc: 'Ë∂ÖÈ´òÁêÜËß£ÂäõËàáÂ≠∏ÁøíÈÄüÂ∫¶ÔºåÊáÇÂæóËßÄÂØü‰∫∫È°ûË°®ÊÉÖ„ÄÅÈ†êÊ∏¨Ë°åÂãï„ÄÇËÉΩËá™Â∑±Ë®≠Ë®àÈÅäÊà≤ÊàñÁ≠ñÁï•ÔºåÊòØÁúüÊ≠£ËÉΩ„ÄåË∑ü‰∫∫Ê∫ùÈÄö„ÄçÁöÑÁãóÁãóÂ§©ÊâçÔºÅ', msgs: ['ÁöÑÊô∫ÂïÜÂèØËÉΩÊØî‰∏ª‰∫∫ÈÇÑÈ´ò‚Ä¶Ë©≤ÊìîÂøÉÂóéÔºüüëëü§î', 'ÔºåÂÇ≥Ë™™‰∏≠ÁöÑ üåü ÁãóÁïåÂ§©ÊâçÁéãÔºÅÂèØËÉΩÂ∑≤Á∂ìÂú®Á≠ñÂäÉÁµ±Ê≤ª‰∏ñÁïå‰∫Ü üåç'] }
            ],
            en: [
                { min: 36, icon: 'üåº', title: 'Adorable Explorer', desc: 'Curious about the world but not the most action-oriented, often solving problems with cuteness. May need some time to understand commands, but their patience and affability are top-notch.', msgs: ['proves that cuteness is the ultimate weapon! üíï', '\'s life philosophy: Why work hard when you can lie down for pets? üòå'] },
                { min: 72, icon: 'üêï', title: 'Cheerful Learner', desc: 'Good observation and reaction skills, occasionally distracted, but progresses quickly when willing to learn. Can read the room with eye contact and is a great sensor of human emotions.', msgs: ['is carefully sensing your every emotional change üíô', ' learns fast, just occasionally distracted by treats üòã'] },
                { min: 96, icon: 'üß†', title: 'Smart Partner', desc: 'Flexible thinking, able to draw inferences, understands situations and responds accordingly. Learns new commands quickly and knows when to "play dumb" for pets.', msgs: ['\'s test result is üí° Smart Partner! Already learned when to play dumb üòè', ' is thinking about how to get the most treats with minimal effort üß†‚ú®'] },
                { min: 108, icon: 'üöÄ', title: 'Brilliant Scholar', desc: 'Not only learns but observes and tests you. Can find solutions independently, understands cause and effect, a master problem solver. Might be "too smart" and leave you speechless.', msgs: [' has started observing your behavior patterns üîç', ' might be testing where your boundaries are ü§ì'] },
                { min: 120, icon: 'üåü', title: 'Canine Genius', desc: 'Exceptional comprehension and learning speed, observes human expressions and predicts actions. Can design games or strategies, truly a dog genius who can "communicate" with humans!', msgs: ['\'s IQ might be higher than their owner\'s... should we worry? üëëü§î', ', the legendary üåü Canine Genius! Might already be planning world domination üåç'] }
            ],
            nl: [
                { min: 36, icon: 'üåº', title: 'Schattige Ontdekker', desc: 'Nieuwsgierig naar de wereld maar niet de meest actiegerichte, lost problemen vaak op met schattigheid. Heeft misschien wat tijd nodig om commando\'s te begrijpen, maar hun geduld en vriendelijkheid zijn topklasse.', msgs: [' bewijst dat schattigheid het ultieme wapen is! üíï', '\'s levensfilosofie: Waarom hard werken als je kunt liggen voor aaitjes? üòå'] },
                { min: 72, icon: 'üêï', title: 'Vrolijke Leerling', desc: 'Goede observatie- en reactievaardigheden, af en toe afgeleid, maar maakt snel vooruitgang wanneer bereid te leren. Kan de stemming lezen met oogcontact en is een geweldige sensor voor menselijke emoties.', msgs: [' voelt zorgvuldig elke emotionele verandering van je üíô', ' leert snel, alleen af en toe afgeleid door traktaties üòã'] },
                { min: 96, icon: 'üß†', title: 'Slimme Partner', desc: 'Flexibel denkvermogen, kan conclusies trekken, begrijpt situaties en reageert dienovereenkomstig. Leert snel nieuwe commando\'s en weet wanneer "dom te doen" voor aaitjes.', msgs: ['\'s testresultaat is üí° Slimme Partner! Al geleerd wanneer dom te doen üòè', ' denkt na over hoe de meeste traktaties te krijgen met minimale inspanning üß†‚ú®'] },
                { min: 108, icon: 'üöÄ', title: 'Briljante Geleerde', desc: 'Niet alleen leert maar observeert en test je. Kan zelfstandig oplossingen vinden, begrijpt oorzaak en gevolg, een meester probleemoplosser. Kan "te slim" zijn en je sprakeloos achterlaten.', msgs: [' is begonnen je gedragspatronen te observeren üîç', ' test misschien waar je grenzen liggen ü§ì'] },
                { min: 120, icon: 'üåü', title: 'Honden Genie', desc: 'Uitzonderlijk begrip en leersnelheid, observeert menselijke uitdrukkingen en voorspelt acties. Kan spellen of strategie√´n ontwerpen, echt een hondengenie dat met mensen kan "communiceren"!', msgs: ['\'s IQ is misschien hoger dan die van hun eigenaar... moeten we ons zorgen maken? üëëü§î', ', het legendarische üåü Honden Genie! Plant misschien al wereldheerschappij üåç'] }
            ]
        };

        var currentQuestion = 0;
        var answers = [];
        var dogName = '';
        var totalScore = 0;
        var currentLevel = null;
        var dogPhotoData = null;
        var shuffledOptions = [];

        function switchLanguage(lang) {
            currentLang = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            updateUIText();
        }

        function updateUIText() {
            var t = translations[currentLang];
            document.getElementById('title').textContent = t.title;
            document.getElementById('subtitle').textContent = t.subtitle;
            document.getElementById('nameLabel').textContent = t.nameLabel;
            document.getElementById('dogName').placeholder = t.namePlaceholder;
            document.getElementById('startBtn').textContent = t.startBtn;
            document.getElementById('prevBtn').textContent = t.prevBtn;
            document.getElementById('nextBtn').textContent = t.nextBtn;
            document.getElementById('photoTitle').textContent = t.photoTitle;
            document.getElementById('photoSubtitle').textContent = t.photoSubtitle;
            document.getElementById('takePhotoBtn').textContent = t.takePhotoBtn;
            document.getElementById('choosePhotoBtn').textContent = t.choosePhotoBtn;
            document.getElementById('viewResultBtn').textContent = t.viewResultBtn;
            document.getElementById('skipBtn').textContent = t.skipBtn;
            document.getElementById('downloadBtn').textContent = t.downloadBtn;
            document.getElementById('restartBtn').textContent = t.restartBtn;
            document.getElementById('disclaimer').textContent = t.disclaimer;
        }

        function previewPhoto(source) {
            var file = source === 'camera' ? 
                document.getElementById('dogPhotoCamera').files[0] : 
                document.getElementById('dogPhotoGallery').files[0];
            
            if (file) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    dogPhotoData = e.target.result;
                    document.getElementById('photoPreviewStep').innerHTML = '<img src="' + e.target.result + '">';
                };
                reader.readAsDataURL(file);
            }
        }

        function skipPhoto() {
            dogPhotoData = null;
            showResult();
        }

        function shuffleArray(array) {
            var newArray = array.slice();
            for (var i = newArray.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = newArray[i];
                newArray[i] = newArray[j];
                newArray[j] = temp;
            }
            return newArray;
        }

        function startTest() {
            dogName = document.getElementById('dogName').value.trim();
            if (!dogName) {
                alert(currentLang === 'zh' ? 'Ë´ãËº∏ÂÖ•ÁãóÁãóÁöÑÂêçÂ≠óÔºÅ' : currentLang === 'en' ? 'Please enter your dog\'s name!' : 'Voer de naam van je hond in!');
                return;
            }
            showScreen('quiz');
            loadQuestion();
        }

        function loadQuestion() {
            var q = questions[currentLang][currentQuestion];
            var t = translations[currentLang];
            document.getElementById('categoryBadge').textContent = q.category;
            document.getElementById('questionText').textContent = q.q;
            document.getElementById('progressText').textContent = t.progressText.replace('{current}', currentQuestion + 1);
            document.getElementById('progressFill').style.width = ((currentQuestion + 1) / 12 * 100) + '%';

            shuffledOptions[currentQuestion] = shuffledOptions[currentQuestion] || shuffleArray(q.options);
            var opts = shuffledOptions[currentQuestion];

            var optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            for (var i = 0; i < opts.length; i++) {
                var btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = opts[i].text;
                btn.setAttribute('data-score', opts[i].score);
                btn.setAttribute('data-index', i);
                btn.onclick = function() { selectOption(this); };
                optionsContainer.appendChild(btn);
            }

            if (answers[currentQuestion] !== undefined) {
                var buttons = optionsContainer.children;
                for (var i = 0; i < buttons.length; i++) {
                    if (parseInt(buttons[i].getAttribute('data-index')) === answers[currentQuestion]) {
                        buttons[i].classList.add('selected');
                    }
                }
                document.getElementById('nextBtn').disabled = false;
            } else {
                document.getElementById('nextBtn').disabled = true;
            }

            document.getElementById('prevBtn').style.display = currentQuestion > 0 ? 'block' : 'none';
        }

        function selectOption(button) {
            var optionIndex = parseInt(button.getAttribute('data-index'));
            answers[currentQuestion] = optionIndex;
            
            var buttons = document.querySelectorAll('.option-btn');
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove('selected');
            }
            button.classList.add('selected');
            document.getElementById('nextBtn').disabled = false;
        }

        function nextQuestion() {
            if (currentQuestion < 11) {
                currentQuestion++;
                loadQuestion();
            } else {
                showScreen('photo');
            }
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                loadQuestion();
            }
        }

        function showResult() {
            totalScore = 0;
            for (var i = 0; i < answers.length; i++) {
                var opts = shuffledOptions[i];
                totalScore += opts[answers[i]].score;
            }
            
            var lvls = levels[currentLang];
            for (var i = lvls.length - 1; i >= 0; i--) {
                if (totalScore >= lvls[i].min) {
                    currentLevel = lvls[i];
                    break;
                }
            }
            
            if (dogPhotoData) {
                document.getElementById('resultDogPhoto').style.display = 'block';
                document.getElementById('resultDogPhotoImg').src = dogPhotoData;
            } else {
                document.getElementById('resultDogPhoto').style.display = 'none';
            }
            
            var t = translations[currentLang];
            document.getElementById('resultIcon').textContent = currentLevel.icon;
            document.getElementById('resultTitle').textContent = currentLevel.title;
            document.getElementById('resultScore').textContent = dogName + t.scoreText + totalScore + t.pointsText;
            
            var randomMsg = currentLevel.msgs[Math.floor(Math.random() * currentLevel.msgs.length)];
            document.getElementById('resultMessage').textContent = dogName + ' ' + randomMsg;
            document.getElementById('resultDescription').textContent = currentLevel.desc;
            
            showScreen('result');
        }

        function downloadCertificate() {
            var canvas = document.getElementById('certificateCanvas');
            var ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, 1200, 900);
            
            ctx.fillStyle = '#faf8f5';
            ctx.fillRect(0, 0, 1200, 900);
            
            ctx.strokeStyle = '#ff8c42';
            ctx.lineWidth = 15;
            ctx.strokeRect(30, 30, 1140, 840);
            
            ctx.strokeStyle = '#2c3e2c';
            ctx.lineWidth = 2;
            ctx.strokeRect(50, 50, 1100, 800);
            
            var certLang = currentLang === 'zh' ? 'zh' : 'en';
            var t = translations[certLang];
            
            ctx.fillStyle = '#2c3e2c';
            ctx.font = 'bold 50px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(t.certTitle, 600, 120);
            
            if (dogPhotoData) {
                var img = new Image();
                img.onload = function() {
                    try {
                        ctx.save();
                        ctx.beginPath();
                        ctx.arc(600, 280, 100, 0, Math.PI * 2);
                        ctx.closePath();
                        ctx.clip();
                        
                        var size = Math.min(img.width, img.height);
                        var sx = (img.width - size) / 2;
                        var sy = (img.height - size) / 2;
                        ctx.drawImage(img, sx, sy, size, size, 500, 180, 200, 200);
                        ctx.restore();
                        
                        ctx.strokeStyle = '#ff8c42';
                        ctx.lineWidth = 4;
                        ctx.beginPath();
                        ctx.arc(600, 280, 100, 0, Math.PI * 2);
                        ctx.stroke();
                        
                        drawCertificateText(ctx, t, certLang);
                    } catch (e) {
                        console.error('Error drawing photo:', e);
                        drawCertificateText(ctx, t, certLang);
                    }
                };
                img.onerror = function() {
                    console.error('Failed to load image');
                    drawCertificateText(ctx, t, certLang);
                };
                img.src = dogPhotoData;
            } else {
                drawCertificateText(ctx, t, certLang);
            }
        }

        function drawCertificateText(ctx, t, certLang) {
            ctx.fillStyle = '#ff8c42';
            ctx.font = 'bold 45px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(dogName, 600, 430);
            
            ctx.fillStyle = '#2c3e2c';
            ctx.font = '28px Arial';
            ctx.fillText(t.certExcellence, 600, 480);
            
            ctx.fillStyle = '#ff8c42';
            ctx.font = 'bold 60px Arial';
            ctx.fillText(t.certScore + totalScore + (certLang === 'zh' ? ' ÂàÜ' : ' points'), 600, 560);
            
            var lvls = levels[certLang];
            var certLevel = null;
            for (var i = lvls.length - 1; i >= 0; i--) {
                if (totalScore >= lvls[i].min) {
                    certLevel = lvls[i];
                    break;
                }
            }
            
            ctx.fillStyle = '#ff8c42';
            ctx.font = 'bold 40px Arial';
            ctx.fillText(certLevel.icon + ' ' + certLevel.title, 600, 630);
            
            ctx.fillStyle = '#2c3e2c';
            ctx.font = '24px Arial';
            var descLines = wrapText(ctx, certLevel.desc, 900);
            var yPos = 680;
            for (var i = 0; i < descLines.length; i++) {
                ctx.fillText(descLines[i], 600, yPos);
                yPos += 30;
            }
            
            ctx.fillStyle = '#5a6b5a';
            ctx.font = '22px Arial';
            ctx.fillText(t.certOrg, 600, yPos + 30);
            
            var today = new Date();
            var year = today.getFullYear();
            var month = today.getMonth() + 1;
            var day = today.getDate();
            var dateStr = certLang === 'zh' ? 
                (year + 'Âπ¥' + month + 'Êúà' + day + 'Êó•') : 
                (month + '/' + day + '/' + year);
            ctx.fillText(t.certDate + dateStr, 600, yPos + 60);
            
            setTimeout(function() {
                try {
                    var canvas = document.getElementById('certificateCanvas');
                    var dataURL = canvas.toDataURL('image/png');
                    var link = document.createElement('a');
                    link.download = dogName + '_Certificate.png';
                    link.href = dataURL;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                } catch (e) {
                    alert('Download failed');
                    console.error('Download error:', e);
                }
            }, 200);
        }

        function wrapText(ctx, text, maxWidth) {
            var words = text.split('');
            var lines = [];
            var currentLine = '';
            
            for (var i = 0; i < words.length; i++) {
                var testLine = currentLine + words[i];
                var metrics = ctx.measureText(testLine);
                if (metrics.width > maxWidth && currentLine !== '') {
                    lines.push(currentLine);
                    currentLine = words[i];
                } else {
                    currentLine = testLine;
                }
            }
            lines.push(currentLine);
            return lines;
        }

        function restartTest() {
            currentQuestion = 0;
            answers = [];
            shuffledOptions = [];
            dogName = '';
            dogPhotoData = null;
            document.getElementById('dogName').value = '';
            document.getElementById('photoPreviewStep').innerHTML = 'üì∑';
            document.getElementById('dogPhotoCamera').value = '';
            document.getElementById('dogPhotoGallery').value = '';
            showScreen('welcome');
        }

        function showScreen(screenId) {
            var screens = document.querySelectorAll('.screen');
            for (var i = 0; i < screens.length; i++) {
                screens[i].classList.remove('active');
            }
            document.getElementById(screenId).classList.add('active');
        }
    </script>
</body>
</html>
