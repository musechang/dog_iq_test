<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‹—ç‹—æ™ºåŠ›æ¸¬é©—</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #b8d4b8 0%, #a8c9a8 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            max-width: 700px;
            width: 100%;
            padding: 40px;
            animation: fadeIn 0.5s ease-in;
            border: 4px solid #ff8c42;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .logo {
            text-align: center;
            margin-bottom: 20px;
        }

        .logo-icon {
            width: 120px;
            height: 120px;
            margin: 0 auto;
        }

        h1 {
            color: #2c3e2c;
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #5a6b5a;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .input-group {
            margin-bottom: 30px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            color: #2c3e2c;
            font-weight: 600;
        }

        input[type="text"] {
            width: 100%;
            padding: 15px;
            border: 3px solid #ff8c42;
            border-radius: 15px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #ff6b1a;
            box-shadow: 0 0 0 3px rgba(255, 140, 66, 0.2);
        }

        input[type="file"] {
            display: none;
        }

        .photo-upload {
            text-align: center;
            margin-bottom: 20px;
        }

        .photo-preview {
            width: 150px;
            height: 150px;
            margin: 15px auto;
            border-radius: 50%;
            overflow: hidden;
            border: 4px solid #ff8c42;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
        }

        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .btn {
            background: #ff8c42;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 15px;
            font-size: 18px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            font-weight: 600;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 140, 66, 0.3);
            background: #ff7a2e;
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .progress-bar {
            height: 10px;
            background: #e8f0e8;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            border: 2px solid #ff8c42;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff8c42 0%, #ffa560 100%);
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            color: #5a6b5a;
            margin-bottom: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .category-badge {
            display: inline-block;
            background: #fff3e6;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            margin-bottom: 20px;
            color: #ff8c42;
            font-weight: 600;
            border: 2px solid #ff8c42;
        }

        .question {
            font-size: 1.2em;
            color: #2c3e2c;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }

        .option-btn {
            background: white;
            border: 3px solid #e8f0e8;
            padding: 20px;
            border-radius: 15px;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            color: #2c3e2c;
        }

        .option-btn:hover {
            border-color: #ff8c42;
            background: #fff8f2;
        }

        .option-btn.selected {
            border-color: #ff8c42;
            background: #fff3e6;
            font-weight: 600;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn-secondary {
            background: white;
            color: #ff8c42;
            border: 3px solid #ff8c42;
        }

        .btn-secondary:hover {
            background: #fff8f2;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 140, 66, 0.3);
        }

        .result-icon {
            text-align: center;
            font-size: 100px;
            margin: 30px 0;
            animation: bounce 1s ease-in-out;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .result-content {
            background: linear-gradient(135deg, #fff3e6 0%, #ffe4c4 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 3px solid #ff8c42;
        }

        .result-title {
            text-align: center;
            font-size: 2em;
            color: #ff8c42;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .result-score {
            text-align: center;
            font-size: 1.3em;
            color: #2c3e2c;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .result-message {
            text-align: center;
            font-size: 1.1em;
            color: #2c3e2c;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .result-description {
            background: #f8fdf8;
            padding: 20px;
            border-radius: 15px;
            color: #2c3e2c;
            line-height: 1.8;
            border: 3px solid #b8d4b8;
        }

        .share-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        #certificateCanvas {
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 25px;
            }

            h1 {
                font-size: 2em;
            }

            .subtitle {
                font-size: 1em;
            }

            .logo-icon {
                width: 100px;
                height: 100px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="welcome" class="screen active">
            <div class="logo">
                <img src="logo.png" class="logo-icon">
            </div>
            <h1>ç‹—ç‹—æ™ºåŠ›æ¸¬é©—</h1>
            <p class="subtitle">30 é“é¡Œç›®ï¼Œæ­é–‹ä½ å®¶æ¯›å­©çš„å¤©æ‰æŒ‡æ•¸ï¼</p>
            
            <div class="input-group">
                <label for="dogName">è«‹è¼¸å…¥ä½ å®¶ç‹—ç‹—çš„åå­—ï¼š</label>
                <input type="text" id="dogName" placeholder="ä¾‹å¦‚ï¼šChewyã€åˆä¸€" required>
            </div>
            
            <button class="btn" onclick="startTest()">é–‹å§‹æ¸¬é©— ğŸ¾</button>
        </div>

        <div id="quiz" class="screen">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p class="progress-text" id="progressText">ç¬¬ 1 é¡Œï¼Œå…± 30 é¡Œ</p>
            
            <span class="category-badge" id="categoryBadge">ğŸ¾ ç”Ÿæ´»æ‡‰å°èˆ‡æƒ…å¢ƒç†è§£</span>
            
            <div class="question" id="questionText"></div>
            
            <div class="options" id="optionsContainer"></div>
            
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="previousQuestion()" id="prevBtn" style="display:none;">ä¸Šä¸€é¡Œ</button>
                <button class="btn" onclick="nextQuestion()" id="nextBtn" disabled>ä¸‹ä¸€é¡Œ</button>
            </div>
        </div>

        <div id="result" class="screen">
            <div class="result-icon" id="resultIcon"></div>
            
            <div class="result-content">
                <h2 class="result-title" id="resultTitle"></h2>
                <p class="result-score" id="resultScore"></p>
                <p class="result-message" id="resultMessage"></p>
                <div class="result-description" id="resultDescription"></div>
            </div>

            <div class="photo-upload">
                <label style="font-weight: 600; color: #2c3e2c; margin-bottom: 10px; display: block;">ä¸Šå‚³ç‹—ç‹—ç…§ç‰‡ï¼ˆè­‰æ›¸ç”¨ï¼‰ï¼š</label>
                <div class="photo-preview" id="photoPreview">ğŸ“· é»æ“Šä¸Šå‚³ç…§ç‰‡</div>
                <input type="file" id="dogPhoto" accept="image/*" capture="environment" onchange="previewPhoto()">
                <button class="btn btn-secondary" onclick="document.getElementById('dogPhoto').click()" style="margin-bottom: 15px;">é¸æ“‡ç…§ç‰‡</button>
            </div>
            
            <div class="share-buttons">
                <button class="btn" onclick="downloadCertificate()">ä¸‹è¼‰æ™ºåŠ›è­‰æ˜ ğŸ“œ</button>
                <button class="btn btn-secondary" onclick="restartTest()">é‡æ–°æ¸¬é©— ğŸ”„</button>
            </div>
        </div>
    </div>

    <canvas id="certificateCanvas" width="1200" height="800"></canvas>

    <script>
        var questions = [
            { category: 'ğŸ¾ ç”Ÿæ´»æ‡‰å°èˆ‡æƒ…å¢ƒç†è§£', q: 'ç•¶ä½ æ­£åœ¨å¹«ä½ çš„å°ç‹—æº–å‚™æ­£é¤æ™‚ï¼Œå°ç‹—æœ‰æ²’æœ‰ç†è§£ä¸¦ä¸”åšå‡ºåæ‡‰å‘¢ï¼Ÿ', options: [
                { text: 'ç›´æ¥è¡åˆ°å»šæˆ¿ç­‰å¾…', score: 4 },
                { text: 'æœ‰æ„Ÿæ‡‰åˆ°æœ‰äº‹æƒ…è¦ç™¼ç”Ÿäº†', score: 3 },
                { text: 'æ²’æœ‰åæ‡‰', score: 1 }
            ]},
            { category: 'ğŸ¾ ç”Ÿæ´»æ‡‰å°èˆ‡æƒ…å¢ƒç†è§£', q: 'ç•¶ä½ æ”¶æ‹¾èƒŒåŒ…æº–å‚™å‡ºé–€æ—…è¡Œï¼Œç‰ æœƒï¼Ÿ', options: [
                { text: 'æ—©æ—©å¯Ÿè¦ºï¼Œé–‹å§‹è·Ÿè‘—ä½ ', score: 4 },
                { text: 'åˆ°æœ€å¾Œæ‰ç™¼ç¾', score: 3 },
                { text: 'å®Œå…¨ä¸çŸ¥é“', score: 1 }
            ]},
            { category: 'ğŸ¾ ç”Ÿæ´»æ‡‰å°èˆ‡æƒ…å¢ƒç†è§£', q: 'è‹¥ä½ ç”¨æ‰‹æ©ŸéŒ„ä¸‹ç‰ çš„å«è²æ’­æ”¾ï¼Œç‰ æœƒï¼Ÿ', options: [
                { text: 'é¦¬ä¸Šå››è™•æ‰¾ã€Œè‡ªå·±ã€', score: 4 },
                { text: 'æŠ¬é ­è½ä¸€ä¸‹', score: 3 },
                { text: 'æ²’åæ‡‰', score: 1 }
            ]},
            { category: 'ğŸ¾ ç”Ÿæ´»æ‡‰å°èˆ‡æƒ…å¢ƒç†è§£', q: 'ç•¶ç‰ è½åˆ°ä½ èªªã€Œè¦å»æ•£æ­¥å—ï¼Ÿã€æ™‚ï¼Ÿ', options: [
                { text: 'ç§’è¡åˆ°é–€é‚Š', score: 4 },
                { text: 'å…ˆè§€å¯Ÿä½ æ˜¯ä¸æ˜¯èªçœŸçš„', score: 3 },
                { text: 'æ²’ç‰¹åˆ¥åæ‡‰', score: 1 }
            ]},
            { category: 'ğŸ¾ ç”Ÿæ´»æ‡‰å°èˆ‡æƒ…å¢ƒç†è§£', q: 'å°ç‹—å°ä¸åŒé£Ÿç‰©æœ‰æ²’æœ‰ä¸åŒç¨‹åº¦çš„æ„›å¥½ï¼Ÿ', options: [
                { text: 'å°æ–¼æŸäº›é£Ÿç‰©å¾ˆç˜‹ç‹‚', score: 4 },
                { text: 'åˆ†å¾—å‡ºå·®åˆ¥æ²’æœ‰ç‰¹åˆ¥å–œå¥½', score: 3 },
                { text: 'åˆ†ä¸å‡ºä¾†å·®åˆ¥', score: 1 }
            ]},
            { category: 'ğŸ¦´ å•é¡Œè§£æ±ºåŠ›', q: 'ä½ æŠŠé›¶é£Ÿæ”¾åœ¨é€æ˜ç›’å­è£¡ï¼Œç‹—ç‹—æ€éº¼è¾¦ï¼Ÿ', options: [
                { text: 'ç”¨çˆªå­æˆ–é¼»å­è©¦è‘—æ‰“é–‹', score: 4 },
                { text: 'çœ‹è‘—ä½ æ±‚æ•‘', score: 3 },
                { text: 'é¦¬ä¸Šæ”¾æ£„', score: 1 }
            ]},
            { category: 'ğŸ¦´ å•é¡Œè§£æ±ºåŠ›', q: 'ç•¶ç‰ çš„ç©å…·å¡åœ¨æ²™ç™¼ä¸‹æ™‚ï¼Ÿ', options: [
                { text: 'ç”¨çˆªå­æˆ–é¼»å­æ’¥å‡ºä¾†', score: 4 },
                { text: 'å°è‘—æ²™ç™¼å«', score: 3 },
                { text: 'è½‰é ­å»ç©åˆ¥çš„', score: 1 }
            ]},
            { category: 'ğŸ¦´ å•é¡Œè§£æ±ºåŠ›', q: 'ä½ ç”¨ç´™ç®±æ“‹ä½ç‰ çš„è·¯ï¼Œç‰ æœƒï¼Ÿ', options: [
                { text: 'æ‰¾å¦ä¸€é‚Šç¹éå»', score: 4 },
                { text: 'å˜—è©¦æ’é–‹', score: 3 },
                { text: 'å°±ç«™åœ¨åŸåœ°', score: 1 }
            ]},
            { category: 'ğŸ¦´ å•é¡Œè§£æ±ºåŠ›', q: 'ç•¶ä½ æ›æ‰åŸæœ¬æ”¾é›¶é£Ÿçš„ç½å­ï¼Œç‰ æ˜¯å¦èƒ½é¦¬ä¸Šæ‰¾åˆ°æ–°ç½å­ï¼Ÿ', options: [
                { text: 'é¦¬ä¸Šæ‰¾åˆ°', score: 4 },
                { text: 'èèçœ‹å¹¾æ¬¡æ‰çŸ¥é“', score: 3 },
                { text: 'å®Œå…¨æ‰¾ä¸åˆ°', score: 1 }
            ]},
            { category: 'ğŸ¦´ å•é¡Œè§£æ±ºåŠ›', q: 'å°ç‹—æœƒä¸æœƒåœ¨å¤å¤©é‹å‹•å¾Œå£æ¸´æ™‚è‡ªå‹•å»å–æ°´ï¼Ÿ', options: [
                { text: 'æœƒè‡ªå·±æ¸´äº†å°±å»å–', score: 4 },
                { text: 'å¶çˆ¾æœƒè‡ªå·±ä¾†è·Ÿæˆ‘è¦æ°´', score: 3 },
                { text: 'éƒ½è¦æˆ‘æ‹¿æ°´çµ¦ä»–å–', score: 1 }
            ]},
            { category: 'ğŸ¶ ç¤¾äº¤ç†è§£åŠ›', q: 'ç•¶ä½ å‡è£å“­æ™‚ï¼Œç‹—ç‹—æœƒï¼Ÿ', options: [
                { text: 'ç«‹åˆ»é éä¾†å®‰æ’«ä½ ', score: 4 },
                { text: 'è§€å¯Ÿå¹¾ç§’æ‰åæ‡‰', score: 3 },
                { text: 'ä¸€è‡‰å›°æƒ‘', score: 1 }
            ]},
            { category: 'ğŸ¶ ç¤¾äº¤ç†è§£åŠ›', q: 'ç•¶é™Œç”Ÿäººå‘¼å–šç‰ åå­—æ™‚ï¼Œç‰ åæ‡‰ï¼Ÿ', options: [
                { text: 'çœ‹ä½ ç¢ºèªå†æ±ºå®š', score: 4 },
                { text: 'çŒ¶è±«ä¸€ä¸‹', score: 3 },
                { text: 'ç«‹åˆ»è·‘éå»', score: 1 }
            ]},
            { category: 'ğŸ¶ ç¤¾äº¤ç†è§£åŠ›', q: 'ç•¶ä½ æŒ‡è‘—æŸå€‹æ±è¥¿èªªã€Œçœ‹é‚£é‚Šï¼ã€ï¼Œç‰ æœƒï¼Ÿ', options: [
                { text: 'è·Ÿè‘—ä½ æŒ‡çš„æ–¹å‘çœ‹', score: 4 },
                { text: 'çœ‹ä½ çš„æ‰‹æŒ‡', score: 3 },
                { text: 'å®Œå…¨ä¸æ‡‚', score: 1 }
            ]},
            { category: 'ğŸ¶ ç¤¾äº¤ç†è§£åŠ›', q: 'ç•¶ä½ çªç„¶æ”¹è®Šè·¯ç·šèµ°åˆ¥çš„æ–¹å‘ï¼Œç‰ æœƒï¼Ÿ', options: [
                { text: 'ç«‹åˆ»è·Ÿä¸Š', score: 4 },
                { text: 'éå¹¾ç§’æ‰ç™¼ç¾', score: 3 },
                { text: 'é‚„åœ¨åŸè·¯ç­‰ä½ ', score: 1 }
            ]},
            { category: 'ğŸ¶ ç¤¾äº¤ç†è§£åŠ›', q: 'ç•¶å®¶ä¸­å…¶ä»–äººå«ç‰ åå­—æ™‚ï¼Œç‰ æ˜¯å¦åˆ†è¾¨å‡ºèª°åœ¨å«ï¼Ÿ', options: [
                { text: 'æœƒ', score: 4 },
                { text: 'å¶çˆ¾æœƒææ··', score: 3 },
                { text: 'éƒ½è¦çœ‹ä¸€çœ¼æ‰çŸ¥é“', score: 1 }
            ]},
            { category: 'ğŸ§© å­¸ç¿’åŠ›', q: 'å­¸æ–°æŒ‡ä»¤æ™‚ï¼ˆå¦‚ã€Œåä¸‹ã€ï¼‰ï¼Œç‰ å¹³å‡å¹¾æ¬¡èƒ½å­¸æœƒï¼Ÿ', options: [
                { text: '1-3 æ¬¡', score: 4 },
                { text: '4-7 æ¬¡', score: 3 },
                { text: '8 æ¬¡ä»¥ä¸Š', score: 1 }
            ]},
            { category: 'ğŸ§© å­¸ç¿’åŠ›', q: 'è‹¥ä½ æ›æˆä¸åŒèªæ°£èªªæŒ‡ä»¤ï¼ˆå¦‚è¼•è² vs åš´è‚…ï¼‰ï¼Œç‰ èƒ½ç†è§£å—ï¼Ÿ', options: [
                { text: 'æœƒç…§åš', score: 4 },
                { text: 'æœ‰æ™‚æœƒæ··äº‚', score: 3 },
                { text: 'è½ä¸æ‡‚', score: 1 }
            ]},
            { category: 'ğŸ§© å­¸ç¿’åŠ›', q: 'ç•¶ä½ æ•™ç‰ æ–°èŠ±æ¨£ï¼ˆå¦‚è½‰åœˆï¼‰ï¼Œç‰ çš„æ…‹åº¦ï¼Ÿ', options: [
                { text: 'å¾ˆå¿«æŒæ¡ä¸¦æ¨‚åœ¨å…¶ä¸­', score: 4 },
                { text: 'æœ‰é»çŒ¶è±«ä½†æœƒå˜—è©¦', score: 3 },
                { text: 'é¦¬ä¸Šè½‰èº«èµ°é–‹', score: 1 }
            ]},
            { category: 'ğŸ§© å­¸ç¿’åŠ›', q: 'è‹¥ä½ èªªã€Œä¸æ˜¯é€™å€‹ã€ï¼Œç‰ æœƒåœæ­¢å‹•ä½œå—ï¼Ÿ', options: [
                { text: 'é¦¬ä¸Šåœä¸‹', score: 4 },
                { text: 'éå¹¾ç§’æ‰åæ‡‰', score: 3 },
                { text: 'è½ä¸æ‡‚', score: 1 }
            ]},
            { category: 'ğŸ§© å­¸ç¿’åŠ›', q: 'ç•¶ä½ æ›äº†æ–°çš„ç©å…·åç¨±ï¼ˆå¦‚ã€Œçƒçƒã€â†’ã€Œå’¬å’¬ã€ï¼‰ï¼Œç‰ èƒ½è¨˜å¾—å—ï¼Ÿ', options: [
                { text: 'å¾ˆå¿«å°±è¨˜èµ·æ–°åå­—', score: 4 },
                { text: 'è¦ç·´å¹¾æ¬¡', score: 3 },
                { text: 'å®Œå…¨æ··äº‚', score: 1 }
            ]},
            { category: 'ğŸ¾ è§€å¯ŸåŠ›èˆ‡è¨˜æ†¶åŠ›', q: 'ç•¶ä½ å‡è£ä¸Ÿçƒä½†å…¶å¯¦æ²’ä¸Ÿæ™‚ï¼Œç‹—ç‹—çš„åæ‡‰æ˜¯ï¼Ÿ', options: [
                { text: 'é¦¬ä¸Šçœ‹å‡ºä½ åœ¨é¨™ç‰ ', score: 4 },
                { text: 'çœ‹äº†ä¸€ä¸‹åœ°æ¿å¾Œæ‰ç™¼ç¾', score: 3 },
                { text: 'ä¸€ç›´æ‰¾çƒåˆ°è™•è·‘', score: 1 }
            ]},
            { category: 'ğŸ¾ è§€å¯ŸåŠ›èˆ‡è¨˜æ†¶åŠ›', q: 'ä½ æŠŠé›¶é£Ÿè—åœ¨å…©å€‹æ¯å­å…¶ä¸­ä¹‹ä¸€ï¼Œç‹—ç‹—èƒ½è¨˜å¾—åœ¨å“ªå€‹æ¯å­è£¡å—ï¼Ÿ', options: [
                { text: 'ç¸½æ˜¯è¨˜å¾—', score: 4 },
                { text: 'æœ‰æ™‚è¨˜å¾—ã€æœ‰æ™‚å¿˜', score: 3 },
                { text: 'å®Œå…¨å¿˜è¨˜', score: 1 }
            ]},
            { category: 'ğŸ¾ è§€å¯ŸåŠ›èˆ‡è¨˜æ†¶åŠ›', q: 'ç•¶ä½ æ›äº†æ–°ç©¿çš„è¡£æœæˆ–é¦™æ°´ï¼Œç‹—ç‹—æ˜¯å¦èªå‡ºä½ ï¼Ÿ', options: [
                { text: 'é¦¬ä¸ŠçŸ¥é“æ˜¯ä½ ', score: 4 },
                { text: 'å…ˆçŒ¶è±«å†é è¿‘', score: 3 },
                { text: 'ä»¥ç‚ºæ˜¯é™Œç”Ÿäºº', score: 1 }
            ]},
            { category: 'ğŸ¾ è§€å¯ŸåŠ›èˆ‡è¨˜æ†¶åŠ›', q: 'ç•¶ä½ ç§»å‹•ç‰ å¸¸ç¡çš„æ¯¯å­åˆ°åˆ¥çš„åœ°æ–¹ï¼Œç‰ æœƒï¼Ÿ', options: [
                { text: 'ç«‹åˆ»æ‰¾åˆ°ä¸¦èººä¸Šå»', score: 4 },
                { text: 'ç¨å¾®èä¸€èæ‰èººä¸‹', score: 3 },
                { text: 'å®Œå…¨æ²’æ³¨æ„', score: 1 }
            ]},
            { category: 'ğŸ¾ è§€å¯ŸåŠ›èˆ‡è¨˜æ†¶åŠ›', q: 'ç•¶ä½ æ•…æ„èµ°å»é–€å£æ‹¿ç‰½ç¹©ï¼Œç‹—ç‹—åæ‡‰æ˜¯ï¼Ÿ', options: [
                { text: 'ç«‹åˆ»èˆˆå¥®è·³èµ·ä¾†', score: 4 },
                { text: 'çœ‹ä½ å¹¾ç§’æ‰èµ·ä¾†', score: 3 },
                { text: 'å®Œå…¨æ²’åæ‡‰', score: 1 }
            ]},
            { category: 'ğŸ• ç©ºé–“èˆ‡æ„ŸçŸ¥èƒ½åŠ›', q: 'ç•¶ä½ è—é›¶é£Ÿåœ¨å¸ƒä¸‹é¢ï¼Œç‰ æœƒï¼Ÿ', options: [
                { text: 'é¦¬ä¸Šæ€èµ·å¸ƒ', score: 4 },
                { text: 'èä¸€èæ‰å‹•ä½œ', score: 3 },
                { text: 'æ”¾æ£„', score: 1 }
            ]},
            { category: 'ğŸ• ç©ºé–“èˆ‡æ„ŸçŸ¥èƒ½åŠ›', q: 'ç•¶ä½ æ¬å‹•å®¶å…·å¾Œï¼Œç‰ æœƒæ’åˆ°å—ï¼Ÿ', options: [
                { text: 'ç«‹åˆ»é©æ‡‰', score: 4 },
                { text: 'å¶çˆ¾æ’ä¸€ä¸‹', score: 3 },
                { text: 'å¸¸å¸¸å¡ä½', score: 1 }
            ]},
            { category: 'ğŸ• ç©ºé–“èˆ‡æ„ŸçŸ¥èƒ½åŠ›', q: 'ç•¶ç‰ çœ‹åˆ°é¡å­è£¡çš„è‡ªå·±ï¼Œç‰ æœƒï¼Ÿ', options: [
                { text: 'è§€å¯Ÿä¸€ä¸‹å¾Œä¸åœ¨æ„', score: 4 },
                { text: 'å å«å¹¾ä¸‹', score: 3 },
                { text: 'å°é¡å­ç”Ÿæ°£', score: 1 }
            ]},
            { category: 'ğŸ• ç©ºé–“èˆ‡æ„ŸçŸ¥èƒ½åŠ›', q: 'ç•¶ä½ åœ¨å¦ä¸€å€‹æˆ¿é–“å«ç‰ åå­—ï¼Œç‰ èƒ½æ‰¾åˆ°ä½ å—ï¼Ÿ', options: [
                { text: 'é¦¬ä¸Šæ‰¾åˆ°', score: 4 },
                { text: 'è½ä¸€ä¸‹æ–¹å‘æ‰ä¾†', score: 3 },
                { text: 'åˆ°è™•äº‚æ‰¾', score: 1 }
            ]},
            { category: 'ğŸ• ç©ºé–“èˆ‡æ„ŸçŸ¥èƒ½åŠ›', q: 'ç•¶ä½ æ›äº†å®¶è£¡çš„å®¶å…·æ“ºè¨­ï¼Œç‰ æœƒï¼Ÿ', options: [
                { text: 'å¾ˆå¿«ç¿’æ…£æ–°ä½ç½®', score: 4 },
                { text: 'éœ€è¦å¹¾å¤©', score: 3 },
                { text: 'æ˜é¡¯ä¸é©æ‡‰', score: 1 }
            ]}
        ];

        var levels = [
            { min: 30, icon: 'ğŸŒ¼', title: 'å°å¯æ„›æ¢ç´¢å®¶', desc: 'å°ä¸–ç•Œå……æ»¿å¥½å¥‡ä½†è¡Œå‹•æ´¾ä¸å¼·ï¼Œå¸¸ç”¨ã€ŒèŒæ¨£ã€è§£æ±ºå•é¡Œã€‚å¯èƒ½é‚„éœ€è¦ä¸€é»æ™‚é–“ç†è§£æŒ‡ä»¤ï¼Œä½†ç‰ çš„è€å¿ƒèˆ‡è¦ªå’ŒåŠ›çµ•å°æ»¿åˆ†ã€‚', msgs: ['ç”¨ç„¡è¾œå¤§çœ¼è­‰æ˜ï¼šå¯æ„›å°±æ˜¯æœ€å¼·æ­¦å™¨ï¼ğŸ’•', 'çš„äººç”Ÿå“²å­¸ï¼šç‚ºä»€éº¼è¦åŠªåŠ›ï¼Ÿèººè‘—ç­‰æ‘¸æ‘¸ä¸å¥½å—ï¼ŸğŸ˜Œ'] },
            { min: 60, icon: 'ğŸ•', title: 'é–‹æœ—å­¸ç¿’ç”Ÿ', desc: 'è§€å¯ŸåŠ›èˆ‡åæ‡‰åŠ›ä¸éŒ¯ï¼Œå¶çˆ¾æœƒåˆ†å¿ƒï¼Œä½†åªè¦é¡˜æ„å­¸å°±é€²æ­¥å¾ˆå¿«ã€‚æ‡‚å¾—ç”¨çœ¼ç¥è®€ç©ºæ°£ï¼Œæ˜¯äººé¡æƒ…ç·’çš„å¥½æ„Ÿæ‡‰å™¨ã€‚', msgs: ['æ­£åœ¨ç”¨å¿ƒæ„Ÿå—ä½ çš„æ¯å€‹æƒ…ç·’è®ŠåŒ– ğŸ’™', 'å­¸ç¿’é€Ÿåº¦å¿«ï¼Œå°±æ˜¯å¶çˆ¾æœƒè¢«é›¶é£Ÿåˆ†å¿ƒè€Œå·² ğŸ˜‹'] },
            { min: 80, icon: 'ğŸ§ ', title: 'æ©Ÿéˆå¤¥ä¼´å‹', desc: 'æ€è€ƒéˆæ´»ã€èƒ½èˆ‰ä¸€åä¸‰ï¼Œæ‡‚å¾—è§€å¯Ÿæƒ…å¢ƒä¸¦åšå‡ºå°æ‡‰è¡Œå‹•ã€‚å­¸æ–°æŒ‡ä»¤é€Ÿåº¦å¿«ï¼Œä¹ŸçŸ¥é“ä»€éº¼æ™‚å€™è©²ã€Œè£å‚»ã€è¨æ‘¸æ‘¸ã€‚', msgs: ['çš„æ¸¬é©—çµæœæ˜¯ ğŸ’¡ æ©Ÿéˆå¤¥ä¼´å‹ï¼å·²ç¶“å­¸æœƒä»€éº¼æ™‚å€™è©²è£å‚»äº† ğŸ˜', 'åœ¨æ€è€ƒæ€éº¼ç”¨æœ€å°‘åŠ›æ°£ç²å¾—æœ€å¤šé›¶é£Ÿ ğŸ§ âœ¨'] },
            { min: 90, icon: 'ğŸš€', title: 'è°æ˜é«˜æç”Ÿ', desc: 'ä¸åªæœƒå­¸ï¼Œé‚„æœƒè§€å¯Ÿä½ ã€æ¸¬è©¦ä½ ã€‚èƒ½è‡ªå·±æ‰¾è§£æ³•ã€ç†è§£å› æœï¼Œæ˜¯å°å°å•é¡Œè§£æ±ºé«˜æ‰‹ã€‚å¯èƒ½æœƒã€Œå¤ªè°æ˜ã€åˆ°è®“é£¼ä¸»å•å£ç„¡è¨€ã€‚', msgs: ['å·²ç¶“é–‹å§‹è§€å¯Ÿä½ çš„è¡Œç‚ºæ¨¡å¼äº† ğŸ”', 'å¯èƒ½æ­£åœ¨æ¸¬è©¦ä½ çš„åº•ç·šåœ¨å“ªè£¡ ğŸ¤“'] },
            { min: 110, icon: 'ğŸŒŸ', title: 'ç‹—ç•Œå¤©æ‰ç‹', desc: 'è¶…é«˜ç†è§£åŠ›èˆ‡å­¸ç¿’é€Ÿåº¦ï¼Œæ‡‚å¾—è§€å¯Ÿäººé¡è¡¨æƒ…ã€é æ¸¬è¡Œå‹•ã€‚èƒ½è‡ªå·±è¨­è¨ˆéŠæˆ²æˆ–ç­–ç•¥ï¼Œæ˜¯çœŸæ­£èƒ½ã€Œè·Ÿäººæºé€šã€çš„ç‹—ç‹—å¤©æ‰ï¼', msgs: ['çš„æ™ºå•†å¯èƒ½æ¯”ä¸»äººé‚„é«˜â€¦è©²æ“”å¿ƒå—ï¼ŸğŸ‘‘ğŸ¤”', 'ï¼Œå‚³èªªä¸­çš„ ğŸŒŸ ç‹—ç•Œå¤©æ‰ç‹ï¼å¯èƒ½å·²ç¶“åœ¨ç­–åŠƒçµ±æ²»ä¸–ç•Œäº† ğŸŒ'] }
        ];

        var currentQuestion = 0;
        var answers = [];
        var dogName = '';
        var totalScore = 0;
        var currentLevel = null;
        var dogPhotoData = null;
        var shuffledOptions = [];

        function previewPhoto() {
            var file = document.getElementById('dogPhoto').files[0];
            if (file) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    dogPhotoData = e.target.result;
                    document.getElementById('photoPreview').innerHTML = '<img src="' + e.target.result + '">';
                };
                reader.readAsDataURL(file);
            }
        }

        function shuffleArray(array) {
            var newArray = array.slice();
            for (var i = newArray.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = newArray[i];
                newArray[i] = newArray[j];
                newArray[j] = temp;
            }
            return newArray;
        }

        function startTest() {
            dogName = document.getElementById('dogName').value.trim();
            if (!dogName) {
                alert('è«‹è¼¸å…¥ç‹—ç‹—çš„åå­—ï¼');
                return;
            }
            showScreen('quiz');
            loadQuestion();
        }

        function loadQuestion() {
            var q = questions[currentQuestion];
            document.getElementById('categoryBadge').textContent = q.category;
            document.getElementById('questionText').textContent = q.q;
            document.getElementById('progressText').textContent = 'ç¬¬ ' + (currentQuestion + 1) + ' é¡Œï¼Œå…± 30 é¡Œ';
            document.getElementById('progressFill').style.width = ((currentQuestion + 1) / 30 * 100) + '%';

            shuffledOptions[currentQuestion] = shuffledOptions[currentQuestion] || shuffleArray(q.options);
            var opts = shuffledOptions[currentQuestion];

            var optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            for (var i = 0; i < opts.length; i++) {
                var btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = opts[i].text;
                btn.setAttribute('data-score', opts[i].score);
                btn.setAttribute('data-index', i);
                btn.onclick = function() { selectOption(this); };
                optionsContainer.appendChild(btn);
            }

            if (answers[currentQuestion] !== undefined) {
                var buttons = optionsContainer.children;
                for (var i = 0; i < buttons.length; i++) {
                    if (parseInt(buttons[i].getAttribute('data-index')) === answers[currentQuestion]) {
                        buttons[i].classList.add('selected');
                    }
                }
                document.getElementById('nextBtn').disabled = false;
            } else {
                document.getElementById('nextBtn').disabled = true;
            }

            document.getElementById('prevBtn').style.display = currentQuestion > 0 ? 'block' : 'none';
        }

        function selectOption(button) {
            var optionIndex = parseInt(button.getAttribute('data-index'));
            answers[currentQuestion] = optionIndex;
            
            var buttons = document.querySelectorAll('.option-btn');
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove('selected');
            }
            button.classList.add('selected');
            document.getElementById('nextBtn').disabled = false;
        }

        function nextQuestion() {
            if (currentQuestion < 29) {
                currentQuestion++;
                loadQuestion();
            } else {
                showResult();
            }
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                loadQuestion();
            }
        }

        function showResult() {
            totalScore = 0;
            for (var i = 0; i < answers.length; i++) {
                var opts = shuffledOptions[i];
                totalScore += opts[answers[i]].score;
            }
            
            for (var i = levels.length - 1; i >= 0; i--) {
                if (totalScore >= levels[i].min) {
                    currentLevel = levels[i];
                    break;
                }
            }
            
            document.getElementById('resultIcon').textContent = currentLevel.icon;
            document.getElementById('resultTitle').textContent = currentLevel.title;
            document.getElementById('resultScore').textContent = dogName + ' çš„æ™ºå•†å¾—åˆ†ï¼š' + totalScore + ' åˆ†';
            
            var randomMsg = currentLevel.msgs[Math.floor(Math.random() * currentLevel.msgs.length)];
            document.getElementById('resultMessage').textContent = dogName + ' ' + randomMsg;
            document.getElementById('resultDescription').textContent = currentLevel.desc;
            
            showScreen('result');
        }

        function downloadCertificate() {
            var canvas = document.getElementById('certificateCanvas');
            var ctx = canvas.getContext('2d');
            
            // æ¸…ç©ºç•«å¸ƒ
            ctx.clearRect(0, 0, 1200, 800);
            
            // èƒŒæ™¯
            ctx.fillStyle = '#faf8f5';
            ctx.fillRect(0, 0, 1200, 800);
            
            // å¤–æ¡†
            ctx.strokeStyle = '#ff8c42';
            ctx.lineWidth = 15;
            ctx.strokeRect(30, 30, 1140, 740);
            
            // å…§æ¡†
            ctx.strokeStyle = '#2c3e2c';
            ctx.lineWidth = 2;
            ctx.strokeRect(50, 50, 1100, 700);
            
            // æ¨™é¡Œ
            ctx.fillStyle = '#2c3e2c';
            ctx.font = 'bold 50px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('ç‹—ç‹—æ™ºåŠ›æ¸¬é©—è­‰æ˜æ›¸', 600, 120);
            
            // å¦‚æœæœ‰ç…§ç‰‡ï¼Œç¹ªè£½ç…§ç‰‡
            if (dogPhotoData) {
                var img = new Image();
                img.onload = function() {
                    try {
                        ctx.save();
                        ctx.beginPath();
                        ctx.arc(600, 280, 100, 0, Math.PI * 2);
                        ctx.closePath();
                        ctx.clip();
                        
                        var size = Math.min(img.width, img.height);
                        var sx = (img.width - size) / 2;
                        var sy = (img.height - size) / 2;
                        ctx.drawImage(img, sx, sy, size, size, 500, 180, 200, 200);
                        ctx.restore();
                        
                        ctx.strokeStyle = '#ff8c42';
                        ctx.lineWidth = 4;
                        ctx.beginPath();
                        ctx.arc(600, 280, 100, 0, Math.PI * 2);
                        ctx.stroke();
                        
                        drawCertificateText(ctx);
                    } catch (e) {
                        console.error('Error drawing photo:', e);
                        drawCertificateText(ctx);
                    }
                };
                img.onerror = function() {
                    console.error('Failed to load image');
                    drawCertificateText(ctx);
                };
                img.src = dogPhotoData;
            } else {
                drawCertificateText(ctx);
            }
        }

        function drawCertificateText(ctx) {
            // ç‹—ç‹—åå­—
            ctx.fillStyle = '#ff8c42';
            ctx.font = 'bold 40px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(dogName, 600, 430);
            
            // æè¿°æ–‡å­—
            ctx.fillStyle = '#2c3e2c';
            ctx.font = '28px Arial';
            ctx.fillText('åœ¨ç‹—ç‹—æ™ºåŠ›æ¸¬é©—ä¸­è¡¨ç¾å„ªç•°', 600, 480);
            
            // ç­‰ç´šæ¨™é¡Œ
            ctx.fillStyle = '#ff8c42';
            ctx.font = 'bold 36px Arial';
            ctx.fillText(currentLevel.title, 600, 540);
            
            // åˆ†æ•¸
            ctx.fillStyle = '#2c3e2c';
            ctx.font = '30px Arial';
            ctx.fillText('æ™ºå•†å¾—åˆ†ï¼š' + totalScore + ' åˆ†', 600, 590);
            
            // æ—¥æœŸ
            var today = new Date();
            var year = today.getFullYear();
            var month = today.getMonth() + 1;
            var day = today.getDate();
            var dateStr = year + 'å¹´' + month + 'æœˆ' + day + 'æ—¥';
            ctx.fillStyle = '#5a6b5a';
            ctx.font = '22px Arial';
            ctx.fillText('é ’ç™¼æ—¥æœŸï¼š' + dateStr, 600, 650);
            
            // ç¹ªè£½ logo
            drawDogLogo(ctx, 1050, 720);
            
            // ä¸‹è¼‰
            setTimeout(function() {
                try {
                    var canvas = document.getElementById('certificateCanvas');
                    var dataURL = canvas.toDataURL('image/png');
                    var link = document.createElement('a');
                    link.download = dogName + '_æ™ºåŠ›æ¸¬é©—è­‰æ˜.png';
                    link.href = dataURL;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                } catch (e) {
                    alert('ä¸‹è¼‰å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
                    console.error('Download error:', e);
                }
            }, 200);
        }

        function drawDogLogo(ctx, x, y) {
            var scale = 0.35;
            var offsetY = -40;
            
            // å·¦çœ¼åœ“åœˆ
            ctx.fillStyle = '#ff8c42';
            ctx.beginPath();
            ctx.arc(x - 50 * scale, y + offsetY, 40 * scale, 0, Math.PI * 2);
            ctx.fill();
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 6 * scale;
            ctx.stroke();
            
            // å³çœ¼åœ“åœˆ
            ctx.fillStyle = '#ff8c42';
            ctx.beginPath();
            ctx.arc(x + 50 * scale, y + offsetY, 40 * scale, 0, Math.PI * 2);
            ctx.fill();
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 6 * scale;
            ctx.stroke();
            
            // å·¦çœ¼æ˜Ÿè™Ÿ
            ctx.fillStyle = '#000';
            ctx.font = 'bold ' + Math.floor(35 * scale) + 'px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('âœ±', x - 50 * scale, y + offsetY);
            
            // å³çœ¼æ˜Ÿè™Ÿ
            ctx.fillText('âœ±', x + 50 * scale, y + offsetY);
            
            // é¼»å­
            ctx.fillStyle = '#000';
            ctx.beginPath();
            ctx.ellipse(x, y + offsetY + 45 * scale, 10 * scale, 12 * scale, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // å·¦é‚Šå˜´å·´æ›²ç·š
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 6 * scale;
            ctx.lineCap = 'round';
            ctx.beginPath();
            ctx.moveTo(x - 35 * scale, y + offsetY + 55 * scale);
            ctx.quadraticCurveTo(x - 25 * scale, y + offsetY + 68 * scale, x - 12 * scale, y + offsetY + 63 * scale);
            ctx.stroke();
            
            // å³é‚Šå˜´å·´æ›²ç·š
            ctx.beginPath();
            ctx.moveTo(x + 35 * scale, y + offsetY + 55 * scale);
            ctx.quadraticCurveTo(x + 25 * scale, y + offsetY + 68 * scale, x + 12 * scale, y + offsetY + 63 * scale);
            ctx.stroke();
        }

        function shareResult() {
            var text = dogName + ' çš„æ™ºå•†æ¸¬é©—çµæœï¼š\n' + currentLevel.icon + ' ' + currentLevel.title + 'ï¼ˆ' + totalScore + ' åˆ†ï¼‰\n\nç«‹å³æ¸¬è©¦ä½ çš„ç‹—ç‹—';
            
            if (navigator.share) {
                navigator.share({ text: text });
            } else {
                navigator.clipboard.writeText(text);
                alert('çµæœå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
            }
        }

        function restartTest() {
            currentQuestion = 0;
            answers = [];
            shuffledOptions = [];
            dogName = '';
            dogPhotoData = null;
            document.getElementById('dogName').value = '';
            document.getElementById('photoPreview').innerHTML = 'ğŸ“· é»æ“Šä¸Šå‚³ç…§ç‰‡';
            document.getElementById('dogPhoto').value = '';
            showScreen('welcome');
        }

        function showScreen(screenId) {
            var screens = document.querySelectorAll('.screen');
            for (var i = 0; i < screens.length; i++) {
                screens[i].classList.remove('active');
            }
            document.getElementById(screenId).classList.add('active');
        }
    </script>
</body>
</html>
